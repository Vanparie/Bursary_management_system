{% extends 'bursary/officer_base.html' %}

{% block title %}Application Detail{% endblock %}

{% block content %}
<style>
  .section-number {
    display: inline-block;
    background-color: #0d6efd; /* Bootstrap primary */
    color: white;
    font-weight: bold;
    border-radius: 50%;
    width: 32px;
    height: 32px;
    text-align: center;
    line-height: 32px;
    font-size: 16px;
    margin-right: 10px; /* spacing between number and text */
  }
</style>

<div class="container my-4">
  <h2 class="mb-4">üìÑ Bursary Application Details</h2>

  <!-- 1Ô∏è‚É£ Personal Details -->
  <div class="card my-3 shadow-sm">
    <div class="card-body">
      <h5 class="mb-3 d-flex align-items-center">
        <span class="section-number">1</span> Personal Details
      </h5>
      <ul class="list-group list-group-flush">
        <li class="list-group-item"><strong>Full Name:</strong> {{ application.student.full_name }}</li>
        <li class="list-group-item"><strong>ID Number:</strong> {{ application.student.id_number }}</li>
        <li class="list-group-item"><strong>Admission No:</strong> {{ application.student.admission_number }}</li>
        <li class="list-group-item"><strong>Institution:</strong> {{ application.student.institution }}</li>
        <li class="list-group-item"><strong>Course:</strong> {{ application.student.course }}</li>
        <li class="list-group-item"><strong>Year of Study:</strong> {{ application.student.year_of_study }}</li>
        <li class="list-group-item"><strong>Category:</strong> {{ application.student.get_category_display }}</li>
        <li class="list-group-item"><strong>Phone:</strong> {{ application.student.phone }}</li>
        <li class="list-group-item"><strong>Email:</strong> {{ application.student.email }}</li>
        <li class="list-group-item"><strong>Constituency:</strong> {{ application.constituency.name }}</li>
        <li class="list-group-item"><strong>Ward:</strong> {{ application.ward|default:"‚Äî" }}</li>

        <li class="list-group-item"><strong>Disability:</strong> {{ application.student.has_disability|yesno:"Yes,No" }}</li>
        {% if application.student.has_disability %}
          <li class="list-group-item"><strong>Disability Details:</strong> {{ application.student.disability_details }}</li>
        {% endif %}

        <li class="list-group-item"><strong>Received Bursary Before:</strong> {{ application.student.previous_bursary|yesno:"Yes,No" }}</li>
        {% if application.student.previous_bursary %}
          <li class="list-group-item"><strong>Previous Bursary Details:</strong> {{ application.student.previous_bursary_details }}</li>
        {% endif %}
      </ul>
    </div>
  </div>

  <!-- 2Ô∏è‚É£ Parent/Guardian Information -->
  <div class="card my-3 shadow-sm">
    <div class="card-body">
      <h5 class="mb-3 d-flex align-items-center">
        <span class="section-number">2</span> Parent/Guardian Information
      </h5>

      {% if guardians %}
        {% for guardian in guardians %}
          <ul class="list-group list-group-flush mb-3">
            <li class="list-group-item"><strong>Name:</strong> {{ guardian.name }}</li>
            <li class="list-group-item"><strong>Relationship:</strong> {{ guardian.relationship }}</li>
            <li class="list-group-item"><strong>ID Number:</strong> {{ guardian.guardian_id_number }}</li>
            <li class="list-group-item"><strong>Occupation:</strong> {{ guardian.occupation }}</li>
            <li class="list-group-item"><strong>Income (KES):</strong> {{ guardian.income }}</li>
            <li class="list-group-item"><strong>Phone:</strong> {{ guardian.guardian_phone }}</li>
          </ul>
        {% endfor %}
      {% else %}
        <p class="text-muted">No guardian information provided.</p>
      {% endif %}
    </div>
  </div>

  <!-- 3Ô∏è‚É£ Application Info -->
  <div class="card my-3 shadow-sm">
    <div class="card-body">
      <h5 class="mb-3 d-flex align-items-center">
        <span class="section-number">3</span> Application Details
      </h5>
      <ul class="list-group list-group-flush">
        <li class="list-group-item"><strong>Fees Required:</strong> KES {{ application.fees_required|floatformat:0 }}</li>
        <li class="list-group-item"><strong>Fees Paid:</strong> KES {{ application.fees_paid|floatformat:0 }}</li>
        <li class="list-group-item"><strong>Amount Requested:</strong> KES {{ application.amount_requested|floatformat:0 }}</li>
        <li class="list-group-item"><strong>Status:</strong> {{ application.status|capfirst }}</li>
        <li class="list-group-item"><strong>Amount Awarded:</strong> 
          {% if application.amount_awarded %}
            KES {{ application.amount_awarded|floatformat:0 }}
          {% else %}
            <em>Not yet awarded</em>
          {% endif %}
        </li>
        <li class="list-group-item"><strong>Feedback:</strong> {{ application.feedback|default:"‚Äî" }}</li>
      </ul>
    </div>
  </div>

  <!-- 4Ô∏è‚É£ Siblings -->
  <div class="card my-3 shadow-sm">
    <div class="card-body">
      <h5 class="mb-3 d-flex align-items-center">
        <span class="section-number">4</span> Siblings in School
      </h5>
      {% if siblings %}
        <table class="table table-sm table-bordered">
          <thead>
            <tr><th>Name</th><th>School</th><th>Class Level</th></tr>
          </thead>
          <tbody>
            {% for sibling in siblings %}
              <tr>
                <td>{{ sibling.name }}</td>
                <td>{{ sibling.school }}</td>
                <td>{{ sibling.class_level }}</td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      {% else %}
        <p>No siblings listed.</p>
      {% endif %}
    </div>
  </div>

  <!-- 5Ô∏è‚É£ Supporting Documents -->
  <div class="card my-3 shadow-sm">
    <div class="card-body">
      <h5 class="mb-3 d-flex align-items-center">
        <span class="section-number">5</span> Supporting Documents
      </h5>
      {% if supporting_documents %}
        <ul class="list-group">
          {% for doc in supporting_documents %}
            <li class="list-group-item d-flex justify-content-between align-items-center">
              <span>{{ doc.get_document_type_display }}</span>
              <div class="btn-group" role="group">
                <a href="{{ doc.file.url }}" class="btn btn-sm btn-outline-secondary" target="_blank">üëÅ View</a>
                <a href="{{ doc.file.url }}" class="btn btn-sm btn-outline-primary" target="_blank" download>‚¨á Download</a>
              </div>
            </li>
          {% endfor %}
        </ul>
      {% else %}
        <p>No supporting documents uploaded.</p>
      {% endif %}
    </div>
  </div>

  <!-- üéØ Decision Form (Officer Only) -->
  {% if application.status == 'pending' %}
  <div class="card shadow-sm my-4">
    <div class="card-body">
      <h5 class="mb-3">üéØ Make Decision</h5>
      <form method="post" action="{% url 'update_application_status' application.id %}">
        {% csrf_token %}
        <div class="row mb-3">
          <div class="col-md-4">
            <select name="status" class="form-select" required>
              <option value="">Select Decision</option>
              <option value="approved">‚úÖ Approve</option>
              <option value="rejected">‚ùå Reject</option>
            </select>
          </div>
          <div class="col-md-4">
            <input type="number" name="amount_awarded" class="form-control" placeholder="Amount Awarded (KES)">
          </div>
        </div>
        <textarea name="feedback" class="form-control mb-3" placeholder="Optional feedback..." rows="3"></textarea>
        <button class="btn btn-success">Submit Decision</button>
        <a href="{% url 'officer_dashboard' %}" class="btn btn-secondary ms-2">Cancel</a>
      </form>
    </div>
  </div>
  {% endif %}

  <div class="text-center mt-4">
    <a href="{% url 'officer_dashboard' %}" class="btn btn-outline-secondary">‚¨ÖÔ∏è Back to Dashboard</a>
  </div>
</div>
{% endblock %}

