{% extends 'bursary/base.html' %}
{% block content %}
<h3>ðŸ“Š Bursary Admin Dashboard</h3>
<hr>

<form method="get" class="row g-2 mb-3">
  <div class="col-auto">
    <select name="ward" class="form-select">
      <option value="">-- Filter by Ward --</option>
      {% for ward in wards %}
        <option value="{{ ward.id }}" {% if selected_ward == ward.id|stringformat:"s" %}selected{% endif %}>
          {{ ward.name }}
        </option>
      {% endfor %}
    </select>
  </div>

  <div class="col-md-4">
    <label>Filter by Status:</label>
    <select name="status" class="form-select">
      <option value="">-- All --</option>
      <option value="pending" {% if selected_status == "pending" %}selected{% endif %}>Pending</option>
      <option value="approved" {% if selected_status == "approved" %}selected{% endif %}>Approved</option>
      <option value="rejected" {% if selected_status == "rejected" %}selected{% endif %}>Rejected</option>
    </select>
  </div>

  <div class="col-md-2">
    <button type="submit" class="btn btn-primary mt-4">Apply Filters</button>
  </div>
</form>

<div class="row text-center my-4">
  <div class="col-md-3">
    <div class="card bg-light shadow-sm">
      <div class="card-body">
        <h5>Total Applications</h5>
        <h2>{{ total_apps }}</h2>
      </div>
    </div>
  </div>
  <div class="col-md-3">
    <div class="card bg-light shadow-sm">
      <div class="card-body">
        <h5>Total Requested</h5>
        <h2>KES {{ total_requested|floatformat:0 }}</h2>
      </div>
    </div>
  </div>
  <div class="col-md-3">
    <div class="card bg-light shadow-sm">
      <div class="card-body">
        <h5>Total Approved</h5>
        <h2>KES {{ total_approved|floatformat:0 }}</h2>
      </div>
    </div>
  </div>
</div>

<div class="my-5">
  <h5>ðŸ“Š Application Status Breakdown</h5>
  <canvas id="statusChart" width="600" height="300"></canvas>
</div>


{{ status_data|json_script:"status-data" }}

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  const statusData = JSON.parse(document.getElementById('status-data').textContent);

  const ctx = document.getElementById('statusChart').getContext('2d');
  const chart = new Chart(ctx, {
    type: 'bar',
    data: {
      labels: ['Pending', 'Approved', 'Rejected'],
      datasets: [{
        label: 'Applications',
        data: [
          statusData.Pending || 0,
          statusData.Approved || 0,
          statusData.Rejected || 0
        ],
        backgroundColor: ['#ffc107', '#28a745', '#dc3545'],
        borderWidth: 1
      }]
    },
    options: {
      responsive: true,
      plugins: {
        legend: { display: false },
        title: {
          display: true,
          text: 'Bursary Application Status'
        }
      },
      scales: {
        y: {
          beginAtZero: true,
          ticks: {
            precision: 0
          }
        }
      }
    }
  });
</script>

{% endblock %}
